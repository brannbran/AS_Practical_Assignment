@page
@model ResetPasswordModel
@{
ViewData["Title"] = "Reset Password";
}

<div class="container mt-5">
    <div class="row justify-content-center">
  <div class="col-md-8">
            @if (Model.IsValidToken)
        {
         <div class="card">
            <div class="card-header bg-success text-white">
     <h2 class="mb-0"><i class="bi bi-shield-lock"></i> Reset Your Password</h2>
   </div>
               <div class="card-body">
   @if (!string.IsNullOrEmpty(Model.StatusMessage))
        {
           <div class="alert alert-danger alert-dismissible fade show" role="alert">
               @Model.StatusMessage
           <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
     }

    <div class="alert alert-info">
       <h6><i class="bi bi-info-circle"></i> Password Requirements:</h6>
     <ul class="mb-0">
   <li>Minimum 12 characters</li>
         <li>Must contain uppercase, lowercase, digit, and special character</li>
            <li>Cannot reuse your last 2 passwords</li>
           </ul>
          </div>

            <form method="post">
 <input type="hidden" asp-for="Token" />
                <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

     <div class="mb-3">
          <label asp-for="Input.NewPassword" class="form-label"></label>
          <input asp-for="Input.NewPassword" class="form-control" type="password" id="newPassword" />
    <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
      
        <!-- Password Strength Indicator -->
         <div class="mt-2">
        <div class="progress" style="height: 5px;">
      <div class="progress-bar" role="progressbar" id="passwordStrengthBar" style="width: 0%"></div>
       </div>
       <small id="passwordStrengthText" class="form-text"></small>
        </div>
       </div>

<div class="mb-3">
       <label asp-for="Input.ConfirmPassword" class="form-label"></label>
             <input asp-for="Input.ConfirmPassword" class="form-control" type="password" id="confirmPassword" />
       <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
    <div id="passwordMatch" class="mt-1"></div>
          </div>

       <div class="d-grid gap-2">
     <button type="submit" class="btn btn-success btn-lg">
       <i class="bi bi-check-circle"></i> Reset Password
                </button>
     <a asp-page="/Login" class="btn btn-outline-secondary">Cancel</a>
    </div>
         </form>
    </div>
        </div>
            }
    else
            {
    <div class="card border-danger">
    <div class="card-header bg-danger text-white">
   <h2 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Invalid Reset Link</h2>
          </div>
           <div class="card-body">
  <div class="alert alert-danger">
      @if (!string.IsNullOrEmpty(Model.StatusMessage))
          {
              @Model.StatusMessage
                  }
              else
        {
 <p>This password reset link is invalid or has expired.</p>
  }
          </div>

      <h5>What to do next:</h5>
                <ul>
                    <li>Request a new password reset link</li>
      <li>Make sure you're using the latest link from your email</li>
                 <li>Links expire after 1 hour for security</li>
         </ul>

          <div class="d-grid gap-2">
<a asp-page="/ForgotPassword" class="btn btn-primary">
    <i class="bi bi-envelope"></i> Request New Reset Link
        </a>
  <a asp-page="/Login" class="btn btn-outline-secondary">
   <i class="bi bi-arrow-left"></i> Back to Login
          </a>
             </div>
           </div>
       </div>
      }
    </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    @if (Model.IsValidToken)
    {
        <script>
  // Password strength checker
      document.getElementById('newPassword').addEventListener('input', function() {
     const password = this.value;
       let strength = 0;
                
           // Check requirements
    const hasLength = password.length >= 12;
      const hasUppercase = /[A-Z]/.test(password);
           const hasLowercase = /[a-z]/.test(password);
          const hasDigit = /\d/.test(password);
                const hasSpecial = /[^A-Za-z0-9]/.test(password);
           
 // Calculate strength
      if (hasLength) strength++;
      if (hasUppercase) strength++;
         if (hasLowercase) strength++;
           if (hasDigit) strength++;
   if (hasSpecial) strength++;
         
        // Update progress bar
     const percentage = (strength / 5) * 100;
    const progressBar = document.getElementById('passwordStrengthBar');
     const strengthText = document.getElementById('passwordStrengthText');
                
  progressBar.style.width = percentage + '%';
                
if (strength <= 2) {
 progressBar.className = 'progress-bar bg-danger';
           strengthText.textContent = 'Weak Password';
           strengthText.className = 'form-text text-danger';
   } else if (strength <= 4) {
       progressBar.className = 'progress-bar bg-warning';
       strengthText.textContent = 'Medium Password';
          strengthText.className = 'form-text text-warning';
        } else {
    progressBar.className = 'progress-bar bg-success';
         strengthText.textContent = 'Strong Password';
strengthText.className = 'form-text text-success';
   }
      });
         
            // Password match checker
 function checkPasswordMatch() {
            const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
       const matchDiv = document.getElementById('passwordMatch');
            
      if (confirmPassword.length === 0) {
               matchDiv.innerHTML = '';
        return;
        }
      
if (newPassword === confirmPassword) {
        matchDiv.innerHTML = '<small class="text-success">? Passwords match</small>';
} else {
     matchDiv.innerHTML = '<small class="text-danger">? Passwords do not match</small>';
       }
            }
 
            document.getElementById('newPassword').addEventListener('input', checkPasswordMatch);
          document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);
    </script>
    }
}
