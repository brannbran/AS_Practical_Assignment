@page
@model ChangePasswordModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
      <div class="card-header bg-warning text-dark">
                 <h2 class="mb-0"><i class="bi bi-key"></i> Change Password</h2>
      </div>
   <div class="card-body">
       @if (!string.IsNullOrEmpty(Model.StatusMessage))
         {
        <div class="alert @(Model.IsPasswordExpired ? "alert-danger" : "alert-success") alert-dismissible fade show" role="alert">
      @Model.StatusMessage
           <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
     }

 @if (Model.IsPasswordExpired)
            {
           <div class="alert alert-danger">
   <h5><i class="bi bi-exclamation-triangle"></i> Password Expired</h5>
    <p>Your password has expired and must be changed. For security, passwords must be changed every 90 days.</p>
             </div>
            }

     <div class="alert alert-info">
         <h6><i class="bi bi-info-circle"></i> Password Policy:</h6>
            <ul class="mb-0">
     <li>Minimum 12 characters</li>
<li>Must contain uppercase, lowercase, digit, and special character</li>
       <li>Cannot reuse your last 2 passwords</li>
                    <li>Cannot change password within 1 minute of last change</li>
              <li>Password expires after 90 days</li>
         </ul>
         </div>

        <form method="post">
<div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

       <div class="mb-3">
         <label asp-for="Input.CurrentPassword" class="form-label"></label>
        <input asp-for="Input.CurrentPassword" class="form-control" type="password" />
  <span asp-validation-for="Input.CurrentPassword" class="text-danger"></span>
                  </div>

     <div class="mb-3">
     <label asp-for="Input.NewPassword" class="form-label"></label>
     <input asp-for="Input.NewPassword" class="form-control" type="password" id="newPassword" />
   <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
    
 <!-- Password Strength Indicator -->
        <div class="mt-2">
              <div class="progress" style="height: 5px;">
       <div class="progress-bar" role="progressbar" id="passwordStrengthBar" style="width: 0%"></div>
       </div>
  <small id="passwordStrengthText" class="form-text"></small>
    </div>

        <!-- Password Requirements Checklist -->
  <div class="mt-2">
     <small class="text-muted">
  <div id="requirement-length">? At least 12 characters</div>
         <div id="requirement-uppercase">? Contains uppercase letter</div>
       <div id="requirement-lowercase">? Contains lowercase letter</div>
  <div id="requirement-digit">? Contains digit</div>
         <div id="requirement-special">? Contains special character</div>
            </small>
    </div>
 </div>

       <div class="mb-3">
            <label asp-for="Input.ConfirmPassword" class="form-label"></label>
        <input asp-for="Input.ConfirmPassword" class="form-control" type="password" id="confirmPassword" />
                <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
        <div id="passwordMatch" class="mt-1"></div>
           </div>

             <div class="d-grid gap-2">
        <button type="submit" class="btn btn-warning btn-lg">
       <i class="bi bi-key"></i> Change Password
      </button>
             <a asp-page="/Index" class="btn btn-outline-secondary">Cancel</a>
       </div>
   </form>
    </div>
       </div>

    <div class="card mt-3">
        <div class="card-header bg-info text-white">
        <h5 class="mb-0"><i class="bi bi-shield-check"></i> Security Tips</h5>
     </div>
        <div class="card-body">
        <ul>
              <li>Use a unique password that you don't use on other websites</li>
  <li>Consider using a password manager to generate and store strong passwords</li>
         <li>Never share your password with anyone</li>
  <li>Change your password immediately if you suspect unauthorized access</li>
      <li>Enable Two-Factor Authentication for extra security</li>
    </ul>
        </div>
            </div>
  </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Password strength checker
        document.getElementById('newPassword').addEventListener('input', function() {
        const password = this.value;
      let strength = 0;
         
// Check requirements
            const hasLength = password.length >= 12;
   const hasUppercase = /[A-Z]/.test(password);
       const hasLowercase = /[a-z]/.test(password);
  const hasDigit = /\d/.test(password);
  const hasSpecial = /[^A-Za-z0-9]/.test(password);
            
     // Update checklist
         updateRequirement('requirement-length', hasLength);
            updateRequirement('requirement-uppercase', hasUppercase);
            updateRequirement('requirement-lowercase', hasLowercase);
  updateRequirement('requirement-digit', hasDigit);
     updateRequirement('requirement-special', hasSpecial);
      
            // Calculate strength
 if (hasLength) strength++;
            if (hasUppercase) strength++;
   if (hasLowercase) strength++;
       if (hasDigit) strength++;
         if (hasSpecial) strength++;
 
          // Update progress bar
      const percentage = (strength / 5) * 100;
    const progressBar = document.getElementById('passwordStrengthBar');
     const strengthText = document.getElementById('passwordStrengthText');
         
   progressBar.style.width = percentage + '%';
    
            if (strength <= 2) {
         progressBar.className = 'progress-bar bg-danger';
     strengthText.textContent = 'Weak Password';
        strengthText.className = 'form-text text-danger';
            } else if (strength <= 4) {
          progressBar.className = 'progress-bar bg-warning';
                strengthText.textContent = 'Medium Password';
      strengthText.className = 'form-text text-warning';
            } else {
   progressBar.className = 'progress-bar bg-success';
     strengthText.textContent = 'Strong Password';
      strengthText.className = 'form-text text-success';
        }
        });
        
        // Password match checker
        function checkPasswordMatch() {
            const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
            const matchDiv = document.getElementById('passwordMatch');
        
       if (confirmPassword.length === 0) {
    matchDiv.innerHTML = '';
         return;
}
     
            if (newPassword === confirmPassword) {
        matchDiv.innerHTML = '<small class="text-success">? Passwords match</small>';
            } else {
    matchDiv.innerHTML = '<small class="text-danger">? Passwords do not match</small>';
          }
        }
        
        document.getElementById('newPassword').addEventListener('input', checkPasswordMatch);
        document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);
        
        function updateRequirement(elementId, isMet) {
          const element = document.getElementById(elementId);
            if (isMet) {
        element.style.color = 'green';
            element.textContent = '?' + element.textContent.substring(1);
            } else {
          element.style.color = 'red';
   element.textContent = '?' + element.textContent.substring(1);
            }
     }
    </script>
}
